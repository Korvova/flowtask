# Flowtask - –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û–∫—Ä—É–∂–µ–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **–õ–æ–∫–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞**: `/var/www/flowtask` - Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **–£–¥–∞–ª—ë–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä**: Bitrix24 VM 
  - SSH –¥–æ—Å—Ç—É–ø: `ssh root@217.114.10.226` (–ø–∞—Ä–æ–ª—å: ca4^UXhSN@3k)
  - –¢–∞–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è production –≤–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –î–æ—Å—Ç—É–ø—ã –∫ Bitrix24
- **URL**: https://test.test-rms.ru
- **–õ–æ–≥–∏–Ω**: admin
- **–ü–∞—Ä–æ–ª—å**: Asavuf81

### –ü—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è
1. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–¥—ë—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ `/var/www/flowtask`
2. –ò–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–º–º–∏—Ç—è—Ç—Å—è –≤ Git: `git add . && git commit -m "message"`
3. –ü—É—à–∞—Ç—Å—è –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: `git push`
4. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ Bitrix24 –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `deploy.sh` –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

‚ö†Ô∏è **–í–ê–ñ–ù–û**:
- –ù–ï –Ω—É–∂–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –≤ `/var/www/html`
- –ù–ï –Ω—É–∂–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —Ñ–∞–π–ª—ã –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –¢–û–õ–¨–ö–û –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ Bitrix24

## üéØ –û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

**Flowtask** - —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è Bitrix24, –∫–æ—Ç–æ—Ä–æ–µ:
- –†–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ iframe –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –∑–∞–¥–∞—á–∏
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (React Flow)
- –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏ –∏ –ø—Ä–µ–¥–∑–∞–¥–∞—á–∞–º–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Bitrix24 REST API –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ V2 (—Ç–µ–∫—É—â–∞—è)
- **Entity Storage V2**: –û–¥–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `entity.item` —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –ø–æ–ª—é `NAME`
- **EntityManagerV2.js**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–∑–ª–∞–º–∏ –∏ —Å–≤—è–∑—è–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- **FlowCanvasV2.js**: React Flow canvas —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —Å–≤—è–∑–µ–π
- **TaskModalV2.js**: –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á
- **TaskHandler.js**: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π –∑–∞–¥–∞—á

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã
- `handler.php` - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ iframe Bitrix24)
- `components/EntityManagerV2.js` - –º–µ–Ω–µ–¥–∂–µ—Ä –¥–∞–Ω–Ω—ã—Ö
- `components/FlowCanvasV2.js` - –≥–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç canvas
- `components/TaskModalV2.js` - –º–æ–¥–∞–ª–∫–∞ –¥–ª—è –∑–∞–¥–∞—á
- `deploy.sh` - —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä

## üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ù–ê —Å–µ—Ä–≤–µ—Ä–µ Bitrix24:
```bash
# 1. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git add .
git commit -m "–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"

# 2. –ó–∞–ø—É—à–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
git push

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
# –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Bitrix24 —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
```



## üì¶ MCP —Å–µ—Ä–≤–µ—Ä—ã

–î–æ—Å—Ç—É–ø–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
- **b24-dev-mcp**: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Bitrix24 REST API
- **browser-automation**: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **context7**: –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫ (React Flow –∏ –¥—Ä.)

## üé® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Connection Validation (Context7 + React Flow)
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–≤—è–∑–µ–π:
1. –ó–∞–ø—Ä–µ—Ç —Å–∞–º–æ—Å–≤—è–∑–µ–π
2. –ó–∞–ø—Ä–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
3. Future —É–∑–ª—ã –Ω–µ –º–æ–≥—É—Ç –∏–º–µ—Ç—å –∏—Å—Ö–æ–¥—è—â–∏–µ —Å–≤—è–∑–∏

### Entity Storage V2
–í—Å–µ —É–∑–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ:
- `NAME` = `process_{processId}_node_{nodeId}` –¥–ª—è —É–∑–ª–æ–≤
- `NAME` = `process_{processId}_connection_{fromId}_{toId}` –¥–ª—è —Å–≤—è–∑–µ–π

## ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

1. **–ù–ï –ø—ã—Ç–∞—Ç—å—Å—è –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª—ã –ª–æ–∫–∞–ª—å–Ω–æ** - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ Bitrix24
2. **–ù–ï –∑–∞–±—ã–≤–∞—Ç—å –ø—Ä–æ git push** - –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å EntityManagerV2** - —Å—Ç–∞—Ä—ã–π EntityManager deprecated
4. **saveConnection vs addConnection** - saveConnection –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø —É–∑–ª–∞

## üîç –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
git status
git diff

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã
git log --oneline -10

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ
git log -p components/FlowCanvasV2.js
```

---

## üìã –ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á

### –°–µ—Å—Å–∏—è 2025-01-29: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ö–Ω–æ–ø–∫–∏ –≤ NodeToolbar –Ω–µ –∫–ª–∏–∫–∞–ª–∏—Å—å
**–°–∏–º–ø—Ç–æ–º—ã:**
- –ö–Ω–æ–ø–∫–∏ "–£–¥–∞–ª–∏—Ç—å" –∏ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å –Ω–∞–¥ –∫–∞—Ä—Ç–æ—á–∫–æ–π
- –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ
- –ù–µ –±—ã–ª–æ –ª–æ–≥–æ–≤ –≤ –∫–æ–Ω—Å–æ–ª–∏

**–ü—Ä–∏—á–∏–Ω—ã:**
1. `nodeTypes` —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –∑–∞–Ω–æ–≤–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–Ω–¥–µ—Ä–µ ‚Üí React Flow –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞–ª —É–∑–ª—ã ‚Üí –ª–æ–º–∞–ª–∏—Å—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
2. CSS –Ω–µ –±—ã–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω: –Ω—É–∂–µ–Ω `pointer-events: all` –¥–ª—è –∫–Ω–æ–ø–æ–∫

**–†–µ—à–µ–Ω–∏–µ:**
- [FlowCanvasV2.js:41-44] –û–±–µ—Ä–Ω—É–ª nodeTypes –≤ `useMemo(() => ({...}), [])` - —Ç–µ–ø–µ—Ä—å –æ–±—ä–µ–∫—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã–π
- [reactflow.css:115-120] –î–æ–±–∞–≤–∏–ª CSS –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤–Ω—É—Ç—Ä–∏ —É–∑–ª–∞:
  ```css
  .react-flow__node button {
    pointer-events: all !important;
    cursor: pointer !important;
    z-index: 100;
  }
  ```
- [reactflow.css:408-425] –î–æ–±–∞–≤–∏–ª CSS –¥–ª—è NodeToolbar:
  ```css
  .react-flow__node-toolbar {
    z-index: 9999 !important;
    pointer-events: all !important;
  }
  ```

**–ò—Å—Ç–æ—á–Ω–∏–∫:** WebSearch + GitHub issues xyflow/xyflow

**–ö–æ–º–º–∏—Ç—ã:**
- `168fab2` - Fix: Button clicks now work! nodeTypes in useMemo + CSS fix
- `6b1af92` - Restore NodeToolbar: buttons now appear ABOVE card when selected

---

#### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ü—Ä–µ–¥–∑–∞–¥–∞—á–∏ –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å –≤–∏–¥–∏–º—ã–º–∏ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–æ—Å–ª–µ –ø–µ—Ä–µ–≤–æ–¥–∞ –∑–∞–¥–∞—á–∏ –≤ "–ì–æ—Ç–æ–≤–æ" —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å –Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ ‚úÖ
- –ù–æ –ø—Ä–µ–¥–∑–∞–¥–∞—á–∞ –æ—Å—Ç–∞–≤–∞–ª–∞—Å—å –Ω–∞ –ø–æ–ª–æ—Ç–Ω–µ ‚ùå
- –°–≤—è–∑–∏ –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å –Ω–∞ –ø—Ä–µ–¥–∑–∞–¥–∞—á—É, –∞ –Ω–µ –Ω–∞ –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É ‚ùå

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –í `loadProcessData()` –≤—Å–µ —É–∑–ª—ã –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
2. –°–≤—è–∑–∏ —Å—Ç—Ä–æ–∏–ª–∏—Å—å –∏–∑ –≤—Å–µ—Ö —É–∑–ª–æ–≤, –Ω–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–ª–∏—Å—å –Ω–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
3. TaskHandler –≤—ã–∑—ã–≤–∞–ª —Å—Ç–∞—Ä—ã–π FlowCanvas.reloadCanvas()

**–†–µ—à–µ–Ω–∏–µ:**
- [FlowCanvasV2.js:183-191] –î–æ–±–∞–≤–∏–ª —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–∑–∞–¥–∞—á:
  ```javascript
  const visibleNodes = allNodes.filter(node => {
      // –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–µ–¥–∑–∞–¥–∞—á–∞ –ò —É –Ω–µ—ë –µ—Å—Ç—å realTaskId - —Å–∫—Ä—ã–≤–∞–µ–º
      if (node.type === 'future' && node.realTaskId) {
          return false;
      }
      return true;
  });
  ```
- [FlowCanvasV2.js:226-262] –°–æ–∑–¥–∞–ª –∫–∞—Ä—Ç—É –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–∏–ª edges:
  ```javascript
  const futureToTaskMap = {};
  allNodes.forEach(node => {
      if (node.type === 'future' && node.realTaskId) {
          futureToTaskMap[node.nodeId] = 'task-' + node.realTaskId;
      }
  });

  // –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ edges –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º target
  let targetId = conn.id;
  if (futureToTaskMap[targetId]) {
      targetId = futureToTaskMap[targetId];
  }
  ```
- [TaskHandler.js:124-135] –û–±–Ω–æ–≤–ª–µ–Ω callback –Ω–∞ FlowCanvasV2

**–ö–æ–º–º–∏—Ç:** `9339f8d` - Fix: Hide completed future tasks and redirect connections

---

#### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ canvas –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏ –≤–µ—Å—å canvas –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–ª—Å—è
- –ú–µ—Ä—Ü–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- –°–±—Ä–∞—Å—ã–≤–∞–ª–∞—Å—å –ø–æ–∑–∏—Ü–∏—è viewport –∏ zoom

**–ü—Ä–∏—á–∏–Ω–∞:**
`reloadCanvas()` –≤—ã–∑—ã–≤–∞–ª `render()` ‚Üí –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ–≥–æ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:**
- [FlowCanvasV2.js:139-142] –°–æ–∑–¥–∞–ª –º–µ—Ç–æ–¥ `updateNodes()`:
  ```javascript
  window.FlowCanvasV2.updateNodes = () => {
      loadProcessData(); // –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ state —á–µ—Ä–µ–∑ setNodes/setEdges
  };
  ```
- [TaskHandler.js:124-126] –¢–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç `updateNodes()` –≤–º–µ—Å—Ç–æ `reloadCanvas()`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ—Ç –º–µ—Ä—Ü–∞–Ω–∏—è
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è zoom –∏ –ø–æ–∑–∏—Ü–∏—è viewport
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ (—Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ state)
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ React Flow

**–ò—Å—Ç–æ—á–Ω–∏–∫:** Context7 xyflow/xyflow - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ setState

**–ö–æ–º–º–∏—Ç:** `3173988` - Optimize: Update nodes via setState instead of full reload

---

### –°–µ—Å—Å–∏—è 2025-01-29 (–≤—Ç–æ—Ä–∞—è): –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤ –∑–∞–¥–∞—á –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

#### –ü—Ä–æ–±–ª–µ–º–∞: –ó–∞–¥–∞—á–∏ –Ω–µ –º–µ–Ω—è—é—Ç —Ü–≤–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞
**–°–∏–º–ø—Ç–æ–º—ã:**
- –ó–∞–¥–∞—á–∞ 137 –º–µ–Ω—è–µ—Ç —Ü–≤–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ ‚úÖ
- –ó–∞–¥–∞—á–∞ 138 –ù–ï –º–µ–Ω—è–µ—Ç —Ü–≤–µ—Ç –Ω–∞ –ø–æ–ª–æ—Ç–Ω–µ –∑–∞–¥–∞—á–∏ 137 ‚ùå
- –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ü–≤–µ—Ç–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ (–±–µ–ª—ã–π –≤–º–µ—Å—Ç–æ —Å–∏–Ω–µ–≥–æ/–∑–µ–ª–µ–Ω–æ–≥–æ)
- –°–æ–±—ã—Ç–∏—è ONTASKUPDATE –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç –æ—à–∏–±–∫–∏ 400 Bad Request

**–ü—Ä–∏—á–∏–Ω—ã (–Ω–∞–π–¥–µ–Ω–æ —á–µ—Ä–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ):**
1. **BX24.callBind –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ iframe** - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏ 400
2. **updateSingleTaskStatus –æ–±–Ω–æ–≤–ª—è–ª data.status –≤–º–µ—Å—Ç–æ data.statusCode** - TaskNode –∏—Å–ø–æ–ª—å–∑—É–µ—Ç statusCode
3. **updateTaskStatuses –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–ª —Å—Ç–∞—Ç—É—Å—ã** –ø–æ—Å–ª–µ PULL —Å–æ–±—ã—Ç–∏–π - loadProcessData –≤—ã–∑—ã–≤–∞–ª updateTaskStatuses –∫–∞–∂–¥—ã–π —Ä–∞–∑
4. **handleStatusChange –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–ª –≤ Entity Storage** - —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª—è–ª React state
5. **task-138 —Å–æ–∑–¥–∞–Ω –ë–ï–ó realTaskId** - TaskHandler.handleTaskComplete –Ω–µ –¥–æ–±–∞–≤–ª—è–ª realTaskId
6. **PULL –Ω–µ –ø–æ–¥–ø–∏—Å—ã–≤–∞–ª—Å—è –Ω–∞ task-138** - —Ñ–∏–ª—å—Ç—Ä `node.data.realTaskId` –ø—Ä–æ–ø—É—Å–∫–∞–ª –µ—ë

**–†–µ—à–µ–Ω–∏–µ –ø–æ —à–∞–≥–∞–º:**

**–®–∞–≥ 1:** [handler.php:85-90] –£–±—Ä–∞–ª–∏ BX24.callBind - –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ iframe
```javascript
// Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ PullSubscription.js
if (typeof BX !== 'undefined' && typeof BX.PULL !== 'undefined') {
    BX.PULL.start();
}
```

**–®–∞–≥ 2:** [FlowCanvasV2.js:168-170] –ò—Å–ø—Ä–∞–≤–∏–ª–∏ updateSingleTaskStatus - –∏—Å–ø–æ–ª—å–∑—É–µ–º statusCode
```javascript
data: {
    ...node.data,
    statusCode: newStatus,  // TaskNode –∏—Å–ø–æ–ª—å–∑—É–µ—Ç statusCode!
    _updateTime: Date.now()
}
```

**–®–∞–≥ 3:** [FlowCanvasV2.js:264-273] –î–æ–±–∞–≤–∏–ª–∏ —Ñ–ª–∞–≥ isInitialLoad - updateTaskStatuses —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
```javascript
if (isInitialLoadRef.current) {
    await updateTaskStatuses(allNodes, taskNodes);
    isInitialLoadRef.current = false;
} else {
    console.log('‚ÑπÔ∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º updateTaskStatuses (—Å—Ç–∞—Ç—É—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ PULL)');
}
```

**–®–∞–≥ 4:** [FlowCanvasV2.js:579-592] handleStatusChange —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ Entity Storage –ü–ï–†–ï–î –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º UI
```javascript
const allNodes = await EntityManagerV2.loadProcess(window.currentProcessId);
const nodeToUpdate = allNodes.find(n => n.type === 'task' && n.realTaskId === taskId);
if (nodeToUpdate) {
    nodeToUpdate.status = newStatus;
    await EntityManagerV2.saveNode(window.currentProcessId, nodeToUpdate);
}
```

**–®–∞–≥ 5:** [TaskHandler.js:103] –î–æ–±–∞–≤–∏–ª–∏ realTaskId –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏ –∏–∑ –ø—Ä–µ–¥–∑–∞–¥–∞—á–∏
```javascript
const newTaskNode = {
    nodeId: 'task-' + newTaskId,
    type: 'task',
    realTaskId: newTaskId,  // ‚úÖ –î–æ–±–∞–≤–ª—è–µ–º –¥–ª—è PULL –ø–æ–¥–ø–∏—Å–∫–∏!
    // ...
};
```

**–®–∞–≥ 6:** [FlowCanvasV2.js:262-278] –ê–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —É–∑–ª–æ–≤ –±–µ–∑ realTaskId
```javascript
const nodesWithoutRealTaskId = allNodes.filter(n =>
    n.type === 'task' && !n.realTaskId && n.nodeId.startsWith('task-')
);
for (const node of nodesWithoutRealTaskId) {
    const taskId = parseInt(node.nodeId.replace('task-', ''));
    node.realTaskId = taskId;
    await EntityManagerV2.saveNode(window.currentProcessId, node);
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –í—Å–µ –∑–∞–¥–∞—á–∏ –Ω–∞ –ø–æ–ª–æ—Ç–Ω–µ –º–µ–Ω—è—é—Ç —Ü–≤–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –¶–≤–µ—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –°—Ç–∞—Ä—ã–µ —É–∑–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ 400 –≤ –∫–æ–Ω—Å–æ–ª–∏

**–ö–æ–º–º–∏—Ç—ã:**
- `04c4415` - Fix: Real-time status updates for ALL tasks on canvas
- `0e3d9e9` - Fix: Use statusCode instead of status for visual updates
- `d3a905c` - Fix: Prevent status overwrite on canvas reload
- `4a35cc0` - Debug: Add detailed logging for status color changes
- `a36e58e` - Fix: Save status to Entity Storage on PULL events
- `787efa4` - Debug: Add logging for PULL subscription
- `0445570` - Fix: Add realTaskId when creating task from future
- `5583f06` - Fix: Auto-repair task nodes without realTaskId on load

**–í–∞–∂–Ω—ã–µ –Ω–∞—Ö–æ–¥–∫–∏:**
1. **TaskNode –∏—Å–ø–æ–ª—å–∑—É–µ—Ç data.statusCode, –ù–ï data.status** - —á–∞—Å—Ç–∞—è –æ—à–∏–±–∫–∞!
2. **PULL –ø–æ–¥–ø–∏—Å–∫–∞ —Ç—Ä–µ–±—É–µ—Ç realTaskId** - –±–µ–∑ –Ω–µ–≥–æ —Å–æ–±—ã—Ç–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
3. **Entity Storage = –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã** - React state –¥–æ–ª–∂–µ–Ω —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å –Ω–∏–º
4. **BX24.callBind –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ iframe** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å BX.PULL –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ
5. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω–æ** - –±–µ–∑ –Ω–µ–≥–æ –Ω–µ –Ω–∞—à–ª–∏ –±—ã realTaskId: undefined

---

### –°–µ—Å—Å–∏—è 2025-01-29 (—Ç—Ä–µ—Ç—å—è): –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –æ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Ä–æ–¥–∏—Ç–µ–ª–µ–π

#### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–µ–¥–∑–∞–¥–∞—á–∏ –æ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
**–°–∏–º–ø—Ç–æ–º—ã:**
- –°–æ–∑–¥–∞—ë—à—å –ø—Ä–µ–¥–∑–∞–¥–∞—á—É –æ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π (–∑–µ–ª—ë–Ω–æ–π) –∑–∞–¥–∞—á–∏
- –° —É—Å–ª–æ–≤–∏–µ–º "‚ö° –°—Ä–∞–∑—É"
- –ü—Ä–µ–¥–∑–∞–¥–∞—á–∞ –æ—Å—Ç–∞—ë—Ç—Å—è —Å–µ—Ä–æ–π ‚ùå
- –†–µ–∞–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞ –ù–ï —Å–æ–∑–¥–∞—ë—Ç—Å—è ‚ùå

**–õ–æ–≥–∏–∫–∞:** –ï—Å–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞ **—É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞** (—Å—Ç–∞—Ç—É—Å 5), —Ç–æ –ø—Ä–µ–¥–∑–∞–¥–∞—á–∞ —Å —É—Å–ª–æ–≤–∏–µ–º "immediately" –¥–æ–ª–∂–Ω–∞ —Å—Ä–∞–∑—É —Å—Ç–∞—Ç—å —Ä–µ–∞–ª—å–Ω–æ–π –∑–∞–¥–∞—á–µ–π.

**–†–µ—à–µ–Ω–∏–µ:**

**–®–∞–≥ 1:** [TaskModalV2.js:317-346] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ä–æ–¥–∏—Ç–µ–ª—è –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
```javascript
if (futureNode.condition === 'immediately') {
    const allNodes = await EntityManagerV2.loadProcess(processId);
    const sourceNode = allNodes.find(n => n.nodeId === this.currentSourceId);

    if (sourceNode && sourceNode.type === 'task' && sourceNode.status === 5) {
        const newTaskId = await window.TaskHandler.createTaskFromFuture(
            futureNode, sourceNode, processId
        );

        if (newTaskId) {
            futureNode.realTaskId = newTaskId;
            await EntityManagerV2.saveNode(processId, futureNode);
            window.FlowCanvasV2.updateNodes(); // –û–±–Ω–æ–≤–∏—Ç—å canvas
        }
    }
}
```

**–®–∞–≥ 2:** [TaskHandler.js:186-226] –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ createTaskFromFuture()
```javascript
createTaskFromFuture: async function(futureNode, sourceNode, processId) {
    // –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É –≤ Bitrix24
    const newTaskId = await this.createRealTask(
        futureNode.title,
        futureNode.description || '',
        futureNode.responsibleId,
        futureNode.groupId,
        processId
    );

    // –°–æ–∑–¥–∞—Ç—å —É–∑–µ–ª task-XXX —Å realTaskId
    const newTaskNode = {
        nodeId: 'task-' + newTaskId,
        type: 'task',
        realTaskId: newTaskId, // ‚úÖ –î–ª—è PULL –ø–æ–¥–ø–∏—Å–∫–∏
        status: 2,
        // ...
    };

    await EntityManagerV2.saveNode(processId, newTaskNode);
    return newTaskId;
}
```

**–®–∞–≥ 3:** [TaskModalV2.js:342-345] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ canvas –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
```javascript
if (window.FlowCanvasV2 && window.FlowCanvasV2.updateNodes) {
    window.FlowCanvasV2.updateNodes();
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ü—Ä–µ–¥–∑–∞–¥–∞—á–∞ –æ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏ ‚Üí —Å—Ä–∞–∑—É —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ä–µ–∞–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞ –≤ Bitrix24
- ‚úÖ –°–µ—Ä–∞—è –ø—Ä–µ–¥–∑–∞–¥–∞—á–∞ —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å –ø–æ–ª–æ—Ç–Ω–∞ (realTaskId —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
- ‚úÖ –ë–µ–ª–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è
- ‚úÖ –°–≤—è–∑—å –∏–¥—ë—Ç –∫ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–µ
- ‚úÖ PULL –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É (–µ—Å—Ç—å realTaskId)

**–ö–æ–º–º–∏—Ç—ã:**
- `19418ef` - Feature: Auto-create task when adding future to completed task
- `c8c45e2` - Fix: Use futureNode.condition instead of undefined condition variable
- `dc004c6` - Fix: Reload canvas after auto-creating task from future

**–í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:**
1. **–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Ä–æ–¥–∏—Ç–µ–ª—è** –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–µ–¥–∑–∞–¥–∞—á–∏
2. **condition === 'immediately'** - —Ç–æ–ª—å–∫–æ "‚ö° –°—Ä–∞–∑—É", –Ω–µ "–ü–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é"
3. **–í—ã–∑—ã–≤–∞–µ–º updateNodes()** - –±–µ–∑ —ç—Ç–æ–≥–æ canvas –Ω–µ –æ–±–Ω–æ–≤–∏—Ç—Å—è
4. **realTaskId –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω** - –∏–Ω–∞—á–µ PULL –Ω–µ –ø–æ–¥–ø–∏—à–µ—Ç—Å—è

---

### –ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è

#### React Flow: nodeTypes –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–Ω–¥–µ—Ä–µ —Å–æ–∑–¥–∞–≤–∞–ª—Å—è –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç nodeTypes ‚Üí React Flow –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞–ª —É–∑–ª—ã

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
const nodeTypes = useMemo(() => ({
    task: window.TaskNode,
    future: window.TaskNode
}), []);
```

**–ü—Ä–∞–≤–∏–ª–æ:** nodeTypes –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ `useMemo()` –∏–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω–æ.

---

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–∑–ª–æ–≤: setState vs render()
**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
```javascript
reloadCanvas() {
    this.render(); // –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
}
```

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ:**
```javascript
updateNodes() {
    loadProcessData(); // setNodes/setEdges - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ state
}
```

---

#### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–∑–∞–¥–∞—á
**–õ–æ–≥–∏–∫–∞:**
```javascript
if (node.type === 'future' && node.realTaskId) {
    // –≠—Ç–∞ –ø—Ä–µ–¥–∑–∞–¥–∞—á–∞ —É–∂–µ —Å—Ç–∞–ª–∞ –∑–∞–¥–∞—á–µ–π ‚Üí —Å–∫—Ä—ã–≤–∞–µ–º
    return false;
}
```

**–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–µ–π:**
```javascript
const futureToTaskMap = {
    'future-123': 'task-456' // future ‚Üí —Å–æ–∑–¥–∞–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞
};

// –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ edge
let targetId = conn.id;
if (futureToTaskMap[targetId]) {
    targetId = futureToTaskMap[targetId]; // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º!
}
```

---

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

#### –†–∞–±–æ—á–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–∑–∞–¥–∞—á
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–∑–∞–¥–∞—á (–∫–Ω–æ–ø–∫–∞ ‚úèÔ∏è)
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–∑–∞–¥–∞—á (–∫–Ω–æ–ø–∫–∞ üóëÔ∏è)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —É–∑–ª–∞–º–∏
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–≤—è–∑–µ–π (–Ω–µ—Ç –¥—É–±–ª–µ–π, –Ω–µ—Ç —Å–∞–º–æ—Å–≤—è–∑–µ–π)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –∏–∑ –ø—Ä–µ–¥–∑–∞–¥–∞—á
- ‚úÖ –°–∫—Ä—ã—Ç–∏–µ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–∑–∞–¥–∞—á
- ‚úÖ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–µ–π –Ω–∞ –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
- ‚úÖ –ü–ª–∞–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

#### –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- Future —É–∑–ª—ã –Ω–µ –º–æ–≥—É—Ç –∏–º–µ—Ç—å –∏—Å—Ö–æ–¥—è—â–∏—Ö —Å–≤—è–∑–µ–π (–ø–æ –¥–∏–∑–∞–π–Ω—É)
- –£—Å–ª–æ–≤–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è: –ø–æ–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ "immediately"

---

### –§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ —á–∞—Å—Ç–æ –∏–∑–º–µ–Ω—è—é—Ç—Å—è

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `components/FlowCanvasV2.js` - –≥–ª–∞–≤–Ω—ã–π canvas, –ª–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏/–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- `components/TaskNode.js` - –∫–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–¥–∞—á–∏ —Å –∫–Ω–æ–ø–∫–∞–º–∏ NodeToolbar
- `components/TaskModalV2.js` - –º–æ–¥–∞–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `components/EntityManagerV2.js` - —Ä–∞–±–æ—Ç–∞ —Å Bitrix24 Entity Storage
- `components/TaskHandler.js` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –∑–∞–¥–∞—á

**–°—Ç–∏–ª–∏:**
- `assets/css/reactflow.css` - —Å—Ç–∏–ª–∏ React Flow (NodeToolbar, –∫–Ω–æ–ø–∫–∏)
- `assets/css/main.css` - –æ–±—â–∏–µ —Å—Ç–∏–ª–∏

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- `handler.php` - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
- `deploy.sh` - –¥–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä

---

### –°–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏ (TODO)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1:**
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É—Å–ª–æ–≤–∏—è —Å–æ–∑–¥–∞–Ω–∏—è: "delay" (—Å –∑–∞–¥–µ—Ä–∂–∫–æ–π), "ifCancel" (–ø—Ä–∏ –æ—Ç–º–µ–Ω–µ)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—É—é –∏–Ω–¥–∏–∫–∞—Ü–∏—é —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è (pending/created)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2:**
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É: –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —É–∑–ª—ã
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–º–µ–Ω—ã —Å–≤—è–∑–∏ (–∫–Ω–æ–ø–∫–∞ –Ω–∞ edge)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3:**
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ V1 –≤ V2
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π

---

### –°–µ—Å—Å–∏—è 2025-01-30: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∏ –æ–±—â–µ–µ –ø–æ–ª–æ—Ç–Ω–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

#### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –∑–∞–≥—Ä—É–∑–∫–∏ Entity Storage
**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∑–∞–¥–∞—á–∏ –∑–∞–≥—Ä—É–∂–∞–ª–æ—Å—å 1500+ –∑–∞–ø–∏—Å–µ–π
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≤–∏—Å–∞–ª–∞
- `entity.item.get` –≤—ã–∑—ã–≤–∞–ª—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ —Å —É–≤–µ–ª–∏—á–∏–≤–∞—é—â–∏–º—Å—è `start`

**–ü—Ä–∏—á–∏–Ω—ã:**
1. **–ù–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ** - `entity.item.get` –∑–∞–≥—Ä—É–∂–∞–ª –í–°–ï –∑–∞–ø–∏—Å–∏ —Ç–∞–±–ª–∏—Ü—ã
2. **–†—É—á–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ** - `startsWith('process_149_')` –Ω–µ –Ω–∞—Ö–æ–¥–∏–ª —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏
3. **–°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç NAME** - –∑–∞–ø–∏—Å–∏ –∏–º–µ–ª–∏ —Ñ–æ—Ä–º–∞—Ç `process_149` –≤–º–µ—Å—Ç–æ `process_149_node_task-150`
4. **–£—Å–ª–æ–≤–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏** - `items.length === 50` ‚Üí –≤—Å–µ–≥–¥–∞ true –¥–æ –∫–æ–Ω—Ü–∞ —Ç–∞–±–ª–∏—Ü—ã

**–†–µ—à–µ–Ω–∏–µ:**

**–®–∞–≥ 1:** [EntityManagerV2.js:100-105] –î–æ–±–∞–≤–∏–ª–∏ FILTER –≤ –∑–∞–ø—Ä–æ—Å
```javascript
BX24.callMethod('entity.item.get', {
    ENTITY: 'tflow_nodes',
    FILTER: {
        '%NAME': processName  // –ü–æ–∏—Å–∫ –ø–æ –ø–æ–¥—Å—Ç—Ä–æ–∫–µ
    },
    SORT: { ID: 'ASC' },
    start: start
})
```

**–®–∞–≥ 2:** [EntityManagerV2.js:117] –£–ø—Ä–æ—Å—Ç–∏–ª–∏ –∫–æ–¥ - —É–±—Ä–∞–ª–∏ —Ä—É—á–Ω—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
```javascript
const items = result.data();
allItems.push(...items);  // FILTER —É–∂–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª –Ω—É–∂–Ω—ã–µ –∑–∞–ø–∏—Å–∏
```

**–®–∞–≥ 3:** [EntityManagerV2.js:325-327] –î–æ–±–∞–≤–∏–ª–∏ FILTER –≤ getAllProcesses
```javascript
FILTER: {
    '%NAME': 'process_'  // –¢–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
}
```

**–®–∞–≥ 4:** [EntityManagerV2.js:313] –î–æ–±–∞–≤–∏–ª–∏ MAX_RECORDS = 500 –¥–ª—è –∑–∞—â–∏—Ç—ã

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ó–∞–¥–∞—á–∞ 149: –∑–∞–≥—Ä—É–∂–∞–µ—Ç **3 –∑–∞–ø–∏—Å–∏** –≤–º–µ—Å—Ç–æ 1500+
- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
- ‚úÖ ProcessManager —Ç–æ–∂–µ –±—ã—Å—Ç—Ä—ã–π
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –∏ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ NAME

**–ö–æ–º–º–∏—Ç—ã:**
- `d2cc860` - Fix: Use FILTER parameter in entity.item.get
- `875f578` - Fix: Add FILTER to getAllProcesses
- `9345c3e` - Debug: Add batch matching logs
- `287e066` - Fix: Stop infinite loop with smart batch detection

---

#### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ó–∞–¥–∞—á–∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ–±—â–µ–µ –ø–æ–ª–æ—Ç–Ω–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
**–°–∏–º–ø—Ç–æ–º—ã:**
- –ó–∞–¥–∞—á–∞ 151 –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç task-151 –∏ task-152
- –ó–∞–¥–∞—á–∞ 152 –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ task-152
- –ü–æ –ª–æ–≥–∏–∫–µ –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å

**–ü—Ä–∏—á–∏–Ω—ã:**
1. **processId = taskId** - –∫–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ–π ID –∫–∞–∫ processId
2. **–ù–µ—Ç UF –ø–æ–ª—è** - `UF_FLOWTASK_PROCESS_ID` –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏
3. **task.item.userfield.add** –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 400 –æ—à–∏–±–∫—É - –Ω–µ—Ç –ø—Ä–∞–≤ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª–µ

**–†–µ—à–µ–Ω–∏–µ:**

**–®–∞–≥ 1:** [TaskProcessMapping.js] –°–æ–∑–¥–∞–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ processId
```javascript
getProcessId: function(taskId) {
    // –ò—â–µ–º –≤ Entity Storage –∑–∞–ø–∏—Å—å task-{taskId}
    // –ò–∑–≤–ª–µ–∫–∞–µ–º processId –∏–∑ NAME: process_151_node_task-152
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º 151 –≤–º–µ—Å—Ç–æ 152
}
```

**–®–∞–≥ 2:** [handler.php:129-145] –ò—Å–ø–æ–ª—å–∑—É–µ–º TaskProcessMapping –≤–º–µ—Å—Ç–æ UF –ø–æ–ª—è
```javascript
window.TaskProcessMapping.getProcessId(task.id).then(processId => {
    console.log('üìã Process ID:', processId);
    window.currentProcessId = processId;
    window.FlowCanvasV2.render();
});
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ó–∞–¥–∞—á–∞ 152 –Ω–∞—Ö–æ–¥–∏—Ç processId = 151
- ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å 151
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±–µ –∑–∞–¥–∞—á–∏ –Ω–∞ –æ–¥–Ω–æ–º –ø–æ–ª–æ—Ç–Ω–µ
- ‚úÖ –°–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ = –æ–±—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å!

**–ö–æ–º–º–∏—Ç—ã:**
- `e8c27c0` - Feature: Auto-create UF_FLOWTASK_PROCESS_ID field
- `5e13738` - Fix: Use Entity Storage to find processId
- `0fd7ff1` - Clean: Remove UF field creation

---

#### –ü—Ä–æ–±–ª–µ–º–∞ 3: ProcessManager UI
**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- [ProcessManager.js](flowtask/components/ProcessManager.js) - UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏
- –ö–Ω–æ–ø–∫–∞ "üìã –°–ø–∏—Å–æ–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤" –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É canvas
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –∑–∞–¥–∞—á
- –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ –≤—Å–µ–º–∏ —É–∑–ª–∞–º–∏

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
```javascript
getAllProcesses()   // –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
deleteProcess(id)   // –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
```

**–ö–æ–º–º–∏—Ç:** `875f578` - Fix: Add FILTER to getAllProcesses

---

### –ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è

#### FILTER –≤ Bitrix24 Entity Storage
**–ü—Ä–æ–±–ª–µ–º–∞:** `entity.item.get` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é... **–ò–õ–ò –ü–û–î–î–ï–†–ñ–ò–í–ê–ï–¢?**

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä FILTER!
```javascript
BX24.callMethod('entity.item.get', {
    ENTITY: 'tflow_nodes',
    FILTER: {
        '%NAME': 'process_149'  // LIKE '%process_149%'
    }
})
```

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å FILTER:**
- `'%NAME': 'value'` - —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–¥—Å—Ç—Ä–æ–∫—É (LIKE '%value%')
- `'NAME': 'value'` - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
- –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –≤ `CIBlockElement::GetList`

**–ò—Å—Ç–æ—á–Ω–∏–∫:** `mcp__b24-dev-mcp__bitrix-method-details` - entity.item.get

---

#### TaskProcessMapping –≤–º–µ—Å—Ç–æ UF –ø–æ–ª–µ–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–æ–ª—è —Ç—Ä–µ–±—É—é—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–†–µ—à–µ–Ω–∏–µ:** –•—Ä–∞–Ω–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –≤ Entity Storage NAME
```javascript
// –ó–∞–¥–∞—á–∞ 152 —Å–æ–∑–¥–∞–Ω–∞ –∏–∑ –ø—Ä–æ—Ü–µ—Å—Å–∞ 151
// NAME: process_151_node_task-152
//
// TaskProcessMapping.getProcessId(152) => 151
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –ë—ã—Å—Ç—Ä–æ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç FILTER)
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∑–∞–¥–∞—á–∏ –≤ Bitrix24

---

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

#### –†–∞–±–æ—á–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–∑–∞–¥–∞—á
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–∑–∞–¥–∞—á
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–∑–∞–¥–∞—á
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–µ–π
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–≤—è–∑–µ–π
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á
- ‚úÖ –°–∫—Ä—ã—Ç–∏–µ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–∑–∞–¥–∞—á
- ‚úÖ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–µ–π
- ‚úÖ Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤
- ‚úÖ –û–±—â–µ–µ –ø–æ–ª–æ—Ç–Ω–æ –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á ‚≠ê –ù–û–í–û–ï
- ‚úÖ –°–ø–∏—Å–æ–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Å —É–¥–∞–ª–µ–Ω–∏–µ–º ‚≠ê –ù–û–í–û–ï
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (FILTER) ‚≠ê –ù–û–í–û–ï

#### –§–∞–π–ª—ã, –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏:
- `components/EntityManagerV2.js` - FILTER –¥–ª—è loadProcess –∏ getAllProcesses
- `components/ProcessManager.js` - NEW: UI —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏
- `components/TaskProcessMapping.js` - NEW: –ü–æ–∏—Å–∫ processId –∏–∑ Entity Storage
- `components/FlowCanvasV2.js` - –ö–Ω–æ–ø–∫–∞ "–°–ø–∏—Å–æ–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤"
- `handler.php` - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ TaskProcessMapping

---

### –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- Context7 React Flow: `/xyflow/xyflow`
- Bitrix24 REST API: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `mcp__b24-dev-mcp__bitrix-search`

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: https://test.test-rms.ru/flowtask/handler.php
- –¢–µ—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞: https://test.test-rms.ru/company/personal/user/1/tasks/task/view/131/

**Git:**
```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git log --oneline -10

# –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Ñ–∞–π–ª–µ
git show <commit>:path/to/file

# –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ñ–∞–π–ª–∞
git log -p components/FlowCanvasV2.js
```
