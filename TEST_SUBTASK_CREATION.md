# –¢–µ—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–¥–∑–∞–¥–∞—á

## –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –∑–∞–¥–∞—á–∏. –ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `/var/www/html/telegsarflow/event_handlers.php`.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è**: –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `OnTaskUpdate` (—Å—Ç—Ä–æ–∫–∞ 215 –≤ event_handlers.php)
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π**: –§—É–Ω–∫—Ü–∏—è `telegsarflow_CheckAndCreateSubtasks()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
   - –ï—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏ –≤ –ë–î
   - –ò–∑–º–µ–Ω–∏–ª—Å—è –ª–∏ —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏
   - –ï—Å—Ç—å –ª–∏ —Å–≤—è–∑–∏ (edges) –∫ –±—É–¥—É—â–∏–º –∑–∞–¥–∞—á–∞–º (nodes —Å `id: 'new'`)
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ª–∏ —É—Å–ª–æ–≤–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è
3. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –ï—Å–ª–∏ —É—Å–ª–æ–≤–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ä–µ–∞–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞ —á–µ—Ä–µ–∑ `CTasks::Add()`
4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞**: ID —É–∑–ª–∞ –º–µ–Ω—è–µ—Ç—Å—è —Å `'new'` –Ω–∞ `'task-{ID}'`, –∫–∞—Ä—Ç–æ—á–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –±–µ–ª–æ–π

## –£—Å–ª–æ–≤–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á

–í —É–∑–ª–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–∫–∞–∑–∞–Ω–æ –æ–¥–Ω–æ –∏–∑ —É—Å–ª–æ–≤–∏–π –≤ –ø–æ–ª–µ `condition`:

- **"‚û°Ô∏è –°—Ä–∞–∑—É"** –∏–ª–∏ `"immediately"` - —Å–æ–∑–¥–∞—Ç—å —Å—Ä–∞–∑—É –ø—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
- **"‚úÖ –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏"** –∏–ª–∏ `"on_complete"` - —Å–æ–∑–¥–∞—Ç—å –∫–æ–≥–¥–∞ —Å—Ç–∞—Ç—É—Å = 5 (–ó–∞–≤–µ—Ä—à–µ–Ω–∞)
- **"üîç –ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏"** –∏–ª–∏ `"on_approve"` - —Å–æ–∑–¥–∞—Ç—å –∫–æ–≥–¥–∞ —Å—Ç–∞—Ç—É—Å = 4 (–ñ–¥—ë—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è)

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±—É—é –∑–∞–¥–∞—á—É –≤ Bitrix24
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–ü—Ä–æ—Ü–µ—Å—Å—ã"
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –±—É–¥—É—â–µ–π –∑–∞–¥–∞—á–∏
1. –ù–∞–∂–º–∏—Ç–µ "+ –ë—É–¥—É—â–∞—è –∑–∞–¥–∞—á–∞" –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
2. –í –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - **–ù–∞–∑–≤–∞–Ω–∏–µ**: –Ω–∞–ø—Ä–∏–º–µ—Ä "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç"
   - **–û–ø–∏—Å–∞–Ω–∏–µ**: –ª—é–±–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
   - **–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π**: –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - **–£—Å–ª–æ–≤–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è**: –≤—ã–±–µ—Ä–∏—Ç–µ "‚úÖ –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏"
3. –ù–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å"

### –®–∞–≥ 3: –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á
1. –ü—Ä–æ–≤–µ–¥–∏—Ç–µ —Å–≤—è–∑—å –æ—Ç —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏ –∫ –±—É–¥—É—â–µ–π:
   - –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –æ—Ç –ø—Ä–∞–≤–æ–≥–æ handle (circle) —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏
   - –ö –ª–µ–≤–æ–º—É handle (circle) –±—É–¥—É—â–µ–π –∑–∞–¥–∞—á–∏ (—Å–µ—Ä–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏)
2. –ù–∞–∂–º–∏—Ç–µ "üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å"
3. –î–æ–∂–¥–∏—Ç–µ—Å—å —Å–æ–æ–±—â–µ–Ω–∏—è "‚úÖ –ü—Ä–æ—Ü–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω"

### –®–∞–≥ 4: –¢—Ä–∏–≥–≥–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è
1. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –∫ –∫–∞—Ä—Ç–æ—á–∫–µ –∑–∞–¥–∞—á–∏ (–º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É)
2. –ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ –Ω–∞ "–ó–∞–≤–µ—Ä—à–µ–Ω–∞" (–∑–µ–ª—ë–Ω—ã–π —Å—Ç–∞—Ç—É—Å)
3. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 —Å–µ–∫—É–Ω–¥—ã

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

#### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
1. ‚úÖ –í —Å–ø–∏—Å–∫–µ –ø–æ–¥–∑–∞–¥–∞—á –ø–æ—è–≤–∏—Ç—Å—è –Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç"
2. ‚úÖ –ù–∞ –≤–∫–ª–∞–¥–∫–µ "–ü—Ä–æ—Ü–µ—Å—Å—ã" —Å–µ—Ä–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å—Ç–∞–Ω–µ—Ç –±–µ–ª–æ–π/—Ü–≤–µ—Ç–Ω–æ–π
3. ‚úÖ –ù–∞ –∫–∞—Ä—Ç–æ—á–∫–µ –ø–æ—è–≤–∏—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–π ID –∑–∞–¥–∞—á–∏ –≤–º–µ—Å—Ç–æ "–ë—É–¥—É—â–∞—è –∑–∞–¥–∞—á–∞"

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ª–æ–≥–∞—Ö:
```bash
tail -f /var/log/php8.3-fpm.log | grep Telegsarflow
```

–î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å–∏:
```
Telegsarflow: CheckAndCreateSubtasks called for task #8
Telegsarflow: Task #8 changed to status 5, checking for subtasks to create
Telegsarflow: Condition met! Creating subtask from node future-123456
Telegsarflow: Created task #9 from node, parent #8
Telegsarflow: Updated node future-123456 -> task-9 in process graph
```

## –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –Ω–µ —Å–æ–∑–¥–∞–ª–∞—Å—å:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏**:
```bash
tail -100 /var/log/php8.3-fpm.log | grep -i telegsarflow
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –ë–î**:
```bash
mysql -u root -p -e "USE sitemanager; SELECT task_id, LEFT(process_data, 200) FROM telegsarflow_processes;"
```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞**:
- –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
- –ù–∞ –≤–∫–ª–∞–¥–∫–µ "–ü—Ä–æ—Ü–µ—Å—Å—ã" –Ω–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å"
- –í Network –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–≤–µ—Ç –æ—Ç `load_process.php`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
  - –í `nodes` –µ—Å—Ç—å —É–∑–µ–ª —Å `id: 'new'` –∏–ª–∏ `id: 'future-...'`
  - –í `data.condition` —É–∫–∞–∑–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ
  - –í `edges` –µ—Å—Ç—å —Å–≤—è–∑—å –æ—Ç —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏ –∫ –±—É–¥—É—â–µ–π

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–æ–±—ã—Ç–∏–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç**:
```bash
# –í—Ä–µ–º–µ–Ω–Ω–æ –¥–æ–±–∞–≤—å—Ç–µ –≤—ã–≤–æ–¥ –≤ –Ω–∞—á–∞–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏ OnTaskUpdate
tail -f /var/log/php8.3-fpm.log | grep "OnTaskUpdate"
```

5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á**:
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–¥–∞—á–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ GROUP_ID –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π (–µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ –≤ –≥—Ä—É–ø–ø–µ)

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. –ó–∞–¥–∞—á–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ (–Ω–µ –ø—Ä–∏ –¥—Ä—É–≥–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö)
2. –û–¥–Ω–∞ –±—É–¥—É—â–∞—è –∑–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ (–ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è `id` –º–µ–Ω—è–µ—Ç—Å—è —Å `'new'` –Ω–∞ `'task-ID'`)
3. –£—Å–ª–æ–≤–∏–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—Ç—Ä–æ–≥–æ: —Å—Ç–∞—Ç—É—Å 5 –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è, 4 –¥–ª—è –æ–¥–æ–±—Ä–µ–Ω–∏—è

## –ß—Ç–æ –¥–∞–ª—å—à–µ

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
- –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–¥–ª–∞–π–Ω–∞ –∏–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –∑–∞–¥–∞—á–∏
- –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–µ–π –∏ —Å–æ–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —É—Å–ª–æ–≤–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "—á–µ—Ä–µ–∑ 3 –¥–Ω—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è")
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–¥–∑–∞–¥–∞—á–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (—á–µ—Ä–µ–∑ WebSocket –∏–ª–∏ polling)
