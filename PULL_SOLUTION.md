# –ü–æ—Ä—Ç–∞—Ç–∏–≤–Ω–æ–µ PULL —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è Telegsarflow

## –ü—Ä–æ–±–ª–µ–º–∞
–ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø—ã—Ç–∞–ª–∏—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π WebSocket —Å–µ—Ä–≤–µ—Ä –Ω–∞ Node.js –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.
**–ü—Ä–æ–±–ª–µ–º–∞**: –≠—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ - –∫–∞–∂–¥–æ–º—É –∫–ª–∏–µ–Ω—Ç—É –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å Node.js, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å nginx, –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å.

## –†–µ—à–µ–Ω–∏–µ
–ò—Å–ø–æ–ª—å–∑—É–µ–º **—Ç–æ–ª—å–∫–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã Bitrix24**:

### 1. Backend (event_handlers.php)
```php
use Bitrix\Pull\Event;

Event::add($userId, [
    'module_id' => 'telegsarflow',
    'command' => 'task_status_changed',
    'params' => [
        'TASK_ID' => (int)$taskId,
        'STATUS' => (int)$status,
        ...
    ]
]);
```

### 2. Frontend (handler.php)
–¢—Ä–∏ —Å–ø–æ—Å–æ–±–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è PULL —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º fallback:

**–°–ø–æ—Å–æ–± 1**: –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π BX.PULL (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ iframe)
```javascript
const parentBX = window.parent.BX;
if (parentBX && parentBX.PULL) {
    parentBX.PULL.subscribe({
        moduleId: 'telegsarflow',
        callback: handlePullEvent
    });
}
```

**–°–ø–æ—Å–æ–± 2**: –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
```javascript
BX.addCustomEvent("onPullEvent-telegsarflow", function(command, params) {
    handlePullEvent({ command, params });
});
```

**–°–ø–æ—Å–æ–± 3**: Fallback –Ω–∞ polling (–µ—Å–ª–∏ PULL –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
```javascript
// –û–ø—Ä–æ—Å –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
setInterval(checkTaskStatus, 30000);
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ü–æ—Ä—Ç–∞—Ç–∏–≤–Ω–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ª—é–±–æ–º Bitrix24 box –±–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚úÖ **–ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** - –Ω–µ –Ω—É–∂–µ–Ω Node.js, WebSocket, nginx
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback** - –µ—Å–ª–∏ PULL –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ polling
‚úÖ **–ì–æ—Ç–æ–≤–æ –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞** - —É—Å—Ç–∞–Ω–æ–≤–∏–ª –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ **–í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã (PULL/Polling)

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `OnTaskUpdate`
2. Backend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ —á–µ—Ä–µ–∑ `Event::add()` –Ω—É–∂–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
3. Frontend –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ —á–µ—Ä–µ–∑ BX.PULL (–∏–ª–∏ polling)
4. –ö–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–¥–∞—á–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —Å –Ω–æ–≤—ã–º —Ü–≤–µ—Ç–æ–º —Å—Ç–∞—Ç—É—Å–∞

## –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ —Å—Ç–∞—Ç—É—Å–æ–≤

- üü¢ **–ó–µ–ª—ë–Ω—ã–π** - –ó–∞–≤–µ—Ä—à–µ–Ω–∞ (status 5)
- üî¥ **–ö—Ä–∞—Å–Ω—ã–π** - –û—Ç–∫–ª–æ–Ω–µ–Ω–∞ (status 7)
- üü† **–û—Ä–∞–Ω–∂–µ–≤—ã–π** - –ñ–¥—ë—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è (status 4)
- üîµ **–°–∏–Ω–∏–π** - –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è (status 3)
- ‚ö™ **–°–µ—Ä—ã–π** - –ù–æ–≤–∞—è/–ñ–¥—ë—Ç/–û—Ç–ª–æ–∂–µ–Ω–∞ (status 1,2,6)

## –°—Ç–∏–ª—å –∫–∞—Ä—Ç–æ—á–µ–∫

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç–∏–ª–∏ –∫–∞–Ω–±–∞–Ω-–∫–∞—Ä—Ç–æ—á–µ–∫ Bitrix24:
- –¶–≤–µ—Ç–Ω–∞—è –ø–æ–ª–æ—Å–∞ —Å–ª–µ–≤–∞ (border-left)
- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ badges –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ –∏ ID
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–º –∏ –¥–µ–¥–ª–∞–π–Ω–µ
- Hover —ç—Ñ—Ñ–µ–∫—Ç—ã –∏ —Ç–µ–Ω–∏

## –î–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞

–≠—Ç–æ —Ä–µ—à–µ–Ω–∏–µ **–ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–æ –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞**:
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–±–ª–∞–∫–µ –∏ –≤ –∫–æ—Ä–æ–±–∫–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ª—É—á—à–∏–π —Å–ø–æ—Å–æ–± PULL
- Graceful degradation –¥–æ polling –µ—Å–ª–∏ PULL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
