<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ Placements</title>
    <script src="//api.bitrix24.com/api/v1/"></script>
    <style>
        body { font-family: monospace; padding: 20px; }
        pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow: auto; }
        button { padding: 10px 20px; margin: 10px 0; cursor: pointer; }
    </style>
</head>
<body>
    <h1>–ü—Ä–æ–≤–µ—Ä–∫–∞ Placements</h1>
    <button onclick="checkPlacements()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Placements</button>
    <button onclick="fixPlacements()">–ò—Å–ø—Ä–∞–≤–∏—Ç—å Placements</button>
    <pre id="output"></pre>

    <script>
        function log(msg) {
            document.getElementById('output').textContent += msg + '\n';
        }

        BX24.init(function() {
            log('‚úÖ BX24 initialized');
        });

        function checkPlacements() {
            document.getElementById('output').textContent = '';
            log('–ü—Ä–æ–≤–µ—Ä—è–µ–º placements...\n');

            BX24.callMethod('placement.list', {}, function(result) {
                if (result.error()) {
                    log('‚ùå –û—à–∏–±–∫–∞: ' + result.error());
                } else {
                    log('–ù–∞–π–¥–µ–Ω–æ placements: ' + result.data().length);
                    log('\n' + JSON.stringify(result.data(), null, 2));
                }
            });
        }

        function fixPlacements() {
            document.getElementById('output').textContent = '';
            log('–ò—Å–ø—Ä–∞–≤–ª—è–µ–º placements...\n');

            // –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è–µ–º –≤—Å–µ TASK_VIEW_TAB placements
            BX24.callMethod('placement.unbind', {
                PLACEMENT: 'TASK_VIEW_TAB'
            }, function(unbindResult) {
                if (unbindResult.error()) {
                    log('‚ö†Ô∏è Unbind: ' + unbindResult.error());
                } else {
                    log('‚úÖ –°—Ç–∞—Ä—ã–µ placements —É–¥–∞–ª–µ–Ω—ã');
                }

                // –¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º URL
                BX24.callMethod('placement.bind', {
                    PLACEMENT: 'TASK_VIEW_TAB',
                    HANDLER: window.location.origin + '/telegsarflow/handler.php',
                    LANG_ALL: {
                        ru: { TITLE: '–ü—Ä–æ—Ü–µ—Å—Å—ã' },
                        en: { TITLE: 'Processes' }
                    }
                }, function(bindResult) {
                    if (bindResult.error()) {
                        log('‚ùå Bind error: ' + bindResult.error());
                    } else {
                        log('‚úÖ –ù–æ–≤—ã–π placement —Å–æ–∑–¥–∞–Ω!');
                        log('\n' + JSON.stringify(bindResult.data(), null, 2));
                        log('\nüéâ –ì–æ—Ç–æ–≤–æ! –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞–¥–∞—á–∏.');
                    }
                });
            });
        }
    </script>
</body>
</html>
