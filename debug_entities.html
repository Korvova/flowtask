<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Debug Entities</title>
    <script src="//api.bitrix24.com/api/v1/"></script>
    <style>
        body { padding: 20px; font-family: Arial; }
        button { padding: 10px 20px; margin: 5px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .result { margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 5px; white-space: pre-wrap; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üîç –û—Ç–ª–∞–¥–∫–∞ Entity</h1>

    <button onclick="listAllEntities()">1. –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö Entity</button>
    <button onclick="testAddPosition()">2. –¢–µ—Å—Ç: –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é</button>
    <button onclick="testGetPosition()">3. –¢–µ—Å—Ç: –ü–æ–ª—É—á–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é</button>

    <div id="result" class="result">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏...</div>

    <script>
        function log(message) {
            const result = document.getElementById('result');
            result.textContent += message + '\n';
            console.log(message);
        }

        function clearLog() {
            document.getElementById('result').textContent = '';
        }

        BX24.init(function() {
            log('‚úÖ BX24 –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        });

        function listAllEntities() {
            clearLog();
            log('üìã –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö Entity...\n');

            BX24.callMethod('entity.get', {}, function(result) {
                if (result.error()) {
                    log('‚ùå –û–®–ò–ë–ö–ê: ' + JSON.stringify(result.error(), null, 2));
                } else {
                    const entities = result.data();
                    log('‚úÖ –ù–∞–π–¥–µ–Ω–æ Entity: ' + entities.length + '\n');

                    entities.forEach((entity, index) => {
                        log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                        log((index + 1) + '. ENTITY: ' + entity.ENTITY);
                        log('   NAME: ' + entity.NAME);
                    });

                    if (entities.length === 0) {
                        log('\n‚ö†Ô∏è Entity –ù–ï –ù–ê–ô–î–ï–ù–´!');
                        log('–í–æ–∑–º–æ–∂–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏–ª–∏ entity –Ω–µ —Å–æ–∑–¥–∞–Ω—ã.');
                    }
                }
            });
        }

        function testAddPosition() {
            clearLog();
            log('‚ûï –¢–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–¥–∞—á–∏...\n');

            BX24.callMethod('entity.item.add', {
                ENTITY: 'tflow_task_pos',
                NAME: 'Test position for task 99',
                PROPERTY_VALUES: {
                    taskId: '99',
                    positionX: '300',
                    positionY: '200'
                }
            }, function(result) {
                if (result.error()) {
                    log('‚ùå –û–®–ò–ë–ö–ê: ' + JSON.stringify(result.error(), null, 2));
                } else {
                    log('‚úÖ –ü–æ–∑–∏—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
                    log('ID: ' + result.data());
                }
            });
        }

        function testGetPosition() {
            clearLog();
            log('üîç –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–¥–∞—á–∏ 99...\n');

            BX24.callMethod('entity.item.get', {
                ENTITY: 'tflow_task_pos',
                FILTER: {
                    PROPERTY_taskId: '99'
                }
            }, function(result) {
                if (result.error()) {
                    log('‚ùå –û–®–ò–ë–ö–ê: ' + JSON.stringify(result.error(), null, 2));
                } else {
                    const items = result.data();
                    log('‚úÖ –ù–∞–π–¥–µ–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤: ' + items.length + '\n');

                    items.forEach((item, index) => {
                        log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                        log((index + 1) + '. ID: ' + item.ID);
                        log('   NAME: ' + item.NAME);
                        log('   PROPERTY_VALUES: ' + JSON.stringify(item.PROPERTY_VALUES, null, 2));
                    });
                }
            });
        }
    </script>
</body>
</html>
